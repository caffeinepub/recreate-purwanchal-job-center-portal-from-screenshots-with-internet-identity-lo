{
  "kind": "build_request",
  "title": "Handle stopped backend canister during admin login (IC0508 reject code 5)",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the admin login/unlock flow to gracefully handle replica rejection errors that indicate the backend canister is stopped (e.g., Reject code: 5 / Error code: IC0508) when calling the admin check method `isCallerAdmin`, and show a clear English error message that includes the canister ID `gkorp-uqaaa-aaaab-qeptq-cai` and a recommended recovery action (restart/redeploy the canister and refresh).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Reject code: 5 Reject text: Canister gkorp-uqaaa-aaaab-qeptq-cai is stopped... Method name: isCallerAdmin Error code: IC0508"
        ]
      },
      "acceptanceCriteria": [
        "When `actor.isCallerAdmin()` fails with a message containing \"is stopped\" and/or \"IC0508\" and/or \"Reject code: 5\", the UI shows an English error explaining the backend canister is stopped and includes the canister ID `gkorp-uqaaa-aaaab-qeptq-cai`.",
        "The admin UI does not get stuck on an indefinite \"Checking admin access...\" loading state after the failure; the user is returned to the admin gate with the error visible and can retry.",
        "The error shown to the user is not a raw replica/agent error dump; it is a short, actionable message.",
        "Session state is not marked as unlocked when this failure occurs (i.e., `admin_session_unlocked` is not set/kept as `true`)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Centralize formatting of backend/replica errors for admin-related actions (admin unlock and admin CRUD mutations) to ensure errors caused by a stopped canister are consistently recognized and displayed as a friendly English message rather than generic/technical output.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "The replica returned a rejection error... Canister ... is stopped ... IC0508"
        ]
      },
      "acceptanceCriteria": [
        "Admin unlock (password gate) and admin mutations (e.g., create/update/delete posts/vacancies) display the same friendly English message for \"canister is stopped\"/IC0508 errors.",
        "Other existing authorization errors (e.g., \"Unauthorized\" / \"Only admins\") continue to display the existing access-denied guidance and continue to lock the admin session as currently implemented."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui (immutable paths).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Restarting/starting the stopped canister `gkorp-uqaaa-aaaab-qeptq-cai` (this is an operational/deployment action outside the app code).",
    "Changing Internet Identity authentication behavior."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}